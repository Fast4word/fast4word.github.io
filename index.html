<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dunah PlayZone</title>

<meta name="description" content="Dunah PlayZone â€“ Play free online games instantly. No downloads.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0b0f1a">

<link rel="manifest" id="manifest">

<style>
:root {
  --bg:#0b0f1a;
  --panel:#151a2d;
  --accent:#6cf2c2;
  --text:#fff;
  --muted:#9aa3c7;
}

* { box-sizing:border-box; font-family:system-ui,sans-serif }

body {
  margin:0;
  background:linear-gradient(180deg,#0b0f1a,#0e1330);
  color:var(--text);
  display:flex;
  min-height:100vh;
}

aside {
  width:220px;
  background:#0d1225;
  padding:18px;
  overflow-y:auto;
}

aside h2 {
  margin:0 0 10px;
  font-size:1.1rem;
}

.genre {
  padding:8px 10px;
  border-radius:8px;
  cursor:pointer;
  font-size:.9rem;
  color:var(--muted);
}

.genre:hover,
.genre.active {
  background:var(--panel);
  color:var(--accent);
}

main {
  flex:1;
  display:flex;
  flex-direction:column;
}

header {
  padding:18px;
  text-align:center;
}

header h1 {
  margin:0;
  font-size:2rem;
}

header p {
  color:var(--muted);
}

.controls {
  padding:0 18px 18px;
}

.controls input {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  font-size:1rem;
}

.grid {
  padding:0 18px 30px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:16px;
}

.card {
  background:var(--panel);
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  transition:.2s;
}

.card:hover { transform:translateY(-5px); }

.thumb {
  width:100%;
  height:140px;
  object-fit:cover;
}

.card-body { padding:10px; }

.card-title {
  font-weight:600;
  font-size:.95rem;
}

.card-meta {
  font-size:.7rem;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal.active { display:flex }

.modal-content {
  width:min(96vw,1100px);
  background:#000;
  border-radius:14px;
  position:relative;
}

.modal iframe {
  width:100%;
  height:56.25vw;
  max-height:620px;
  border:none;
}

.close {
  position:absolute;
  top:10px;
  right:14px;
  font-size:22px;
  cursor:pointer;
}

@media(max-width:800px){
  aside{ display:none }
}
</style>
</head>
<body>

<aside>
  <h2>Categories</h2>
  <div class="genre active" id="allGenres">All Games</div>
  <div id="genreList"></div>
</aside>

<main>
<header>
  <h1>ðŸŽ® Dunah PlayZone</h1>
  <p>Play instantly Â· No downloads</p>
</header>

<div class="controls">
  <input id="search" placeholder="Search games...">
</div>

<div class="grid" id="grid"></div>
</main>

<div class="modal" id="modal">
  <div class="modal-content">
    <div class="close" onclick="closeGame()">âœ•</div>
    <iframe id="frame" allowfullscreen></iframe>
  </div>
</div>

<script>
const grid = document.getElementById("grid");
const search = document.getElementById("search");
const genreList = document.getElementById("genreList");
const allBtn = document.getElementById("allGenres");
const modal = document.getElementById("modal");
const frame = document.getElementById("frame");

let games = [];
let activeGenre = "all";
let allowedGenres = [];

/* ---------- Helpers ---------- */
function prettyGenre(slug) {
  return slug.replace(/-/g, " ").replace(/\b\w/g, c => c.toUpperCase());
}

/* ---------- Load Games ---------- */
fetch("games.json")
  .then(r => r.json())
  .then(data => {
    let raw = [];

    if (Array.isArray(data.hits)) raw = data.hits;
    else if (Array.isArray(data.segments))
      raw = data.segments.flatMap(s => s.hits || s.items || []);

    games = Object.values(
      Object.fromEntries(raw.map(g => [g.id, g]))
    );

    buildGenres();
    render();
  });

/* ---------- Build Top 10 Categories ---------- */
function buildGenres() {
  genreList.innerHTML = "";
  const counts = {};

  games.forEach(g =>
    (g.genres || []).forEach(x => counts[x] = (counts[x] || 0) + 1)
  );

  allowedGenres = Object.entries(counts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10)
    .map(([g]) => g);

  allowedGenres.forEach(slug => {
    const div = document.createElement("div");
    div.className = "genre";
    div.textContent = prettyGenre(slug);
    div.onclick = () => {
      document.querySelectorAll(".genre").forEach(x => x.classList.remove("active"));
      div.classList.add("active");
      activeGenre = slug;
      render();
    };
    genreList.appendChild(div);
  });
}

allBtn.onclick = () => {
  document.querySelectorAll(".genre").forEach(x => x.classList.remove("active"));
  allBtn.classList.add("active");
  activeGenre = "all";
  render();
};

/* ---------- Render ---------- */
function render() {
  const q = search.value.toLowerCase();
  grid.innerHTML = "";

  games
    .filter(g => {
      const genreOk = activeGenre === "all" || g.genres?.includes(activeGenre);
      const textOk = g.title.toLowerCase().includes(q);
      return genreOk && textOk;
    })
    .forEach(g => {
      const visibleGenres = (g.genres || [])
        .filter(x => allowedGenres.includes(x))
        .map(prettyGenre)
        .join(", ");

      const c = document.createElement("div");
      c.className = "card";
      c.innerHTML = `
        <img class="thumb" src="${g.images?.[0] || ""}">
        <div class="card-body">
          <div class="card-title">${g.title}</div>
          <div class="card-meta">${visibleGenres}</div>
        </div>`;
      c.onclick = () => openGame(g.gameURL);
      grid.appendChild(c);
    });
}

search.oninput = render;

/* ---------- Player ---------- */
function openGame(url){
  frame.src = url;
  modal.classList.add("active");
}
function closeGame(){
  frame.src = "";
  modal.classList.remove("active");
}

/* ---------- PWA ---------- */
const manifest = {
  name: "Dunah PlayZone",
  short_name: "PlayZone",
  start_url: ".",
  display: "standalone",
  background_color: "#0b0f1a",
  theme_color: "#0b0f1a"
};

document.getElementById("manifest").href =
  URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type:"application/json"}));

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register(
    URL.createObjectURL(new Blob([`
      self.addEventListener("install",e=>{
        e.waitUntil(caches.open("dunah-playzone")
          .then(c=>c.addAll(["./","./index.html","./games.json"])));
      });
      self.addEventListener("fetch",e=>{
        e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));
      });
    `], {type:"text/javascript"}))
  );
}
</script>

</body>
</html>
